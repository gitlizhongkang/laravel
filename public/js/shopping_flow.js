var selectedShipping=null;var selectedPayment=null;var selectedPack=null;var selectedCard=null;var selectedSurplus="";var selectedBonus=0;var selectedIntegral=0;var selectedOOS=null;var alertedSurplus=false;var groupBuyShipping=null;var groupBuyPayment=null;function selectShipping(A){if(selectedShipping==A){return}else{selectedShipping=A}var B=A.attributes["supportCod"].value+0;var C=A.form;for(i=0;i<C.elements.length;i++){if(C.elements[i].name=="payment"&&C.elements[i].attributes["isCod"].value=="1"){if(B==0){C.elements[i].checked=false;C.elements[i].disabled=true}else{C.elements[i].disabled=false}}}if(A.attributes["insure"].value+0==0){document.getElementById("ECS_NEEDINSURE").checked=false;document.getElementById("ECS_NEEDINSURE").disabled=true}else{document.getElementById("ECS_NEEDINSURE").checked=false;document.getElementById("ECS_NEEDINSURE").disabled=false}var D=new Date();Ajax.call("flow.php?step=select_shipping","shipping="+A.value,orderShippingSelectedResponse,"GET","JSON")}function orderShippingSelectedResponse(A){if(A.need_insure){try{document.getElementById("ECS_NEEDINSURE").checked=true}catch(B){alert(B.message)}}try{if(document.getElementById("ECS_CODFEE")!=undefined){document.getElementById("ECS_CODFEE").innerHTML=A.cod_fee}}catch(B){alert(B.message)}orderSelectedResponse(A)}function selectPayment(A){if(selectedPayment==A){return}else{selectedPayment=A}Ajax.call("flow.php?step=select_payment","payment="+A.value,orderSelectedResponse,"GET","JSON")}function handleGroupBuyShipping(A){if(groupBuyShipping==A){return}else{groupBuyShipping=A}var B=A.attributes["supportCod"].value+0;var C=A.form;for(i=0;i<C.elements.length;i++){if(C.elements[i].name=="payment"&&C.elements[i].attributes["isCod"].value=="1"){if(B==0){C.elements[i].checked=false;C.elements[i].disabled=true}else{C.elements[i].disabled=false}}}if(A.attributes["insure"].value+0==0){document.getElementById("ECS_NEEDINSURE").checked=false;document.getElementById("ECS_NEEDINSURE").disabled=true}else{document.getElementById("ECS_NEEDINSURE").checked=false;document.getElementById("ECS_NEEDINSURE").disabled=false}Ajax.call("group_buy.php?act=select_shipping","shipping="+A.value,orderSelectedResponse,"GET")}function handleGroupBuyPayment(A){if(groupBuyPayment==A){return}else{groupBuyPayment=A}Ajax.call("group_buy.php?act=select_payment","payment="+A.value,orderSelectedResponse,"GET")}function selectPack(A){if(selectedPack==A){return}else{selectedPack=A}Ajax.call("flow.php?step=select_pack","pack="+A.value,orderSelectedResponse,"GET","JSON")}function selectCard(A){if(selectedCard==A){return}else{selectedCard=A}Ajax.call("flow.php?step=select_card","card="+A.value,orderSelectedResponse,"GET","JSON")}function selectInsure(A){A=A?1:0;Ajax.call("flow.php?step=select_insure","insure="+A,orderSelectedResponse,"GET","JSON")}function handleGroupBuyInsure(A){A=A?1:0;Ajax.call("group_buy.php?act=select_insure","insure="+A,orderSelectedResponse,"GET","JSON")}function orderSelectedResponse(B){if(B.error){alert(B.error);location.href="./"}try{var D=document.getElementById("ECS_ORDERTOTAL");D.innerHTML=(typeof B=="object")?B.content:B;if(B.payment!=undefined){var A=document.forms["theForm"].elements["surplus"];if(A!=undefined){A.disabled=B.pay_code=="balance"}}}catch(C){}}function changeSurplus(A){if(selectedSurplus==A){return}else{selectedSurplus=A}Ajax.call("flow.php?step=change_surplus","surplus="+A,changeSurplusResponse,"GET","JSON")}function changeSurplusResponse(A){if(A.error){try{document.getElementById("ECS_SURPLUS_NOTICE").innerHTML=A.error;document.getElementById("ECS_SURPLUS").value="0";document.getElementById("ECS_SURPLUS").focus()}catch(B){}}else{try{document.getElementById("ECS_SURPLUS_NOTICE").innerHTML=""}catch(B){}orderSelectedResponse(A.content)}}function changeIntegral(A){if(selectedIntegral==A){return}else{selectedIntegral=A}Ajax.call("flow.php?step=change_integral","points="+A,changeIntegralResponse,"GET","JSON")}function changeIntegralResponse(A){if(A.error){try{document.getElementById("ECS_INTEGRAL_NOTICE").innerHTML=A.error;document.getElementById("ECS_INTEGRAL").value="0";document.getElementById("ECS_INTEGRAL").focus()}catch(B){}}else{try{document.getElementById("ECS_INTEGRAL_NOTICE").innerHTML=""}catch(B){}orderSelectedResponse(A.content)}}function changeBonus(A){if(selectedBonus==A){return}else{selectedBonus=A}Ajax.call("flow.php?step=change_bonus","bonus="+A,changeBonusResponse,"GET","JSON")}function changeBonusResponse(A){if(A.error){alert(A.error);try{document.getElementById("ECS_BONUS").value="0"}catch(B){}}else{orderSelectedResponse(A.content)}}function validateBonus(A){Ajax.call("flow.php?step=validate_bonus","bonus_sn="+A,validateBonusResponse,"GET","JSON")}function validateBonusResponse(A){if(A.error){alert(A.error);orderSelectedResponse(A.content);try{document.getElementById("ECS_BONUSN").value="0"}catch(B){}}else{orderSelectedResponse(A.content)}}function changeNeedInv(){var F=document.getElementById("ECS_NEEDINV");var E=document.getElementById("ECS_INVTYPE");var H=document.getElementById("ECS_INVPAYEE");var C=document.getElementById("ECS_INVCONTENT");var A=F.checked?1:0;var D=F.checked?(E!=undefined?E.value:""):"";var B=F.checked?H.value:"";var G=F.checked?C.value:"";E.disabled=H.disabled=C.disabled=!F.checked;if(E!=null){E.disabled=!F.checked}Ajax.call("flow.php?step=change_needinv","need_inv="+A+"&inv_type="+encodeURIComponent(D)+"&inv_payee="+encodeURIComponent(B)+"&inv_content="+encodeURIComponent(G),orderSelectedResponse,"GET")}function groupBuyChangeNeedInv(){var B=document.getElementById("ECS_NEEDINV");var A=document.getElementById("ECS_INVPAYEE");var D=document.getElementById("ECS_INVCONTENT");var C=B.checked?1:0;var F=B.checked?A.value:"";var E=B.checked?D.value:"";A.disabled=D.disabled=!B.checked;Ajax.call("group_buy.php?act=change_needinv","need_idv="+C+"&amp;payee="+F+"&amp;content="+E,null,"GET")}function changeOOS(A){if(selectedOOS==A){return}else{selectedOOS=A}Ajax.call("flow.php?step=change_oos","oos="+A.value,null,"GET")}function checkOrderForm(E){var B=false;var F=false;for(i=0;i<E.elements.length;i++){if(E.elements[i].name=="shipping"&&E.elements[i].checked){F=true}if(E.elements[i].name=="payment"&&E.elements[i].checked){B=true}}if(!F){alert(flow_no_shipping);return false}if(!B){alert(flow_no_payment);return false}if(document.getElementById("ECS_SURPLUS")){var A=document.getElementById("ECS_SURPLUS").value;var C=Utils.trim(Ajax.call("flow.php?step=check_surplus","surplus="+A,null,"GET","TEXT",false));if(C){try{document.getElementById("ECS_SURPLUS_NOTICE").innerHTML=C}catch(D){}return false}}if(document.getElementById("ECS_INTEGRAL")){var G=document.getElementById("ECS_INTEGRAL").value;var C=Utils.trim(Ajax.call("flow.php?step=check_integral","integral="+G,null,"GET","TEXT",false));if(C){return false;try{document.getElementById("ECS_INTEGRAL_NOTICE").innerHTML=C}catch(D){}}}E.action=E.action+"?step=done";return true}function checkConsignee(A){var C=new Array();var B=false;if(A.elements["country"]&&A.elements["country"].value==0){C.push(country_not_null);B=true}if(A.elements["province"]&&A.elements["province"].value==0&&A.elements["province"].length>1){B=true;C.push(province_not_null)}if(A.elements["city"]&&A.elements["city"].value==0&&A.elements["city"].length>1){B=true;C.push(city_not_null)}if(A.elements["district"]&&A.elements["district"].length>1){if(A.elements["district"].value==0){B=true;C.push(district_not_null)}}if(Utils.isEmpty(A.elements["consignee"].value)){B=true;C.push(consignee_not_null)}if(!Utils.isEmail(A.elements["email"].value)){B=true;C.push(invalid_email)}if(A.elements["address"]&&Utils.isEmpty(A.elements["address"].value)){B=true;C.push(address_not_null)}if(A.elements["zipcode"]&&A.elements["zipcode"].value.length>0&&(!Utils.isNumber(A.elements["zipcode"].value))){B=true;C.push(zip_not_num)}if(Utils.isEmpty(A.elements["tel"].value)){B=true;C.push(tele_not_null)}else{if(!Utils.isTel(A.elements["tel"].value)){B=true;C.push(tele_invaild)}}if(A.elements["mobile"]&&A.elements["mobile"].value.length>0&&(!Utils.isTel(A.elements["mobile"].value))){B=true;C.push(mobile_invaild)}if(B){message=C.join("\n");alert(message)}return !B};