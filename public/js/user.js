$(function(){$(".r-tab").mouseup(function(){$(this).addClass("r-check");if($(this).attr("id")=="has_login"){$("#login-box").css("display","block");$("#register-box").css("display","none");$(this).addClass("r-check");$("#no_login").removeClass("r-check");$("input:text,input:password").val("")}else{$(this).addClass("r-check");$("#has_login").removeClass("r-check");$("#register-box").css("display","block");$("#login-box").css("display","none")}$(".err_tip").html("");$(".labelbox").removeClass("params_error");$("input:text,input:password").val("")});var A={usernameValidate:"false",telValidate:"false",passwordValidate:"false",confirmPasswordValidate:"false",codeValidate:"false"};$("#username").blur(function(){var C=$(this).val();var E=C.replace(/[^\x00-\xff]/g,"**").length;var D=$(this);if(C==""){$("#username_notice").html(msg_un_blank);A.usernameValidate=false;return false}if(!chkstr(C)){$("#username_notice").html(msg_un_format);A.usernameValidate=false;return false}if(E<3){$("#username_notice").html(username_shorter);A.usernameValidate=false;return false}if(E>14){$("#username_notice").html(msg_un_length);A.usernameValidate=false;return false}var B="username";$.ajax({type:"GET",async:false,url:uniqueCheck,data:{type:B,value:C},dataType:"json",success:function(F){if(F["code"]==1){$("#username").parent().removeClass("params_error");$("#username").parent().addClass("params_success");$("#username_notice").html("<em></em>");A.usernameValidate=true}else{$("#username").parent().removeClass("params_success");$("#username").parent().addClass("params_error");$("#username_notice").html(msg_un_registered);A.usernameValidate=false}}})});$("#username").keyup(function(){$("#username").parent().removeClass("params_success");$("#username").parent().addClass("params_error");$("#username_notice").html(username_invalid)}).focus(function(){$(this).triggerHandler("keyup")});$("#tel").blur(function(){var D=$(this).val();var C=$(this);var B="tel";if(D==""){$("#tel_notice").html(tel_empty);A.telValidate=false;return false}else{if(!Utils.isTel(D)){$("#tel_notice").html(tel_msg);A.telValidate=false;return false}}$.ajax({type:"GET",async:false,url:uniqueCheck,data:{type:B,value:D},dataType:"json",success:function(E){if(E["code"]==1){$("#tel").parent().removeClass("params_error");$("#tel").parent().addClass("params_success");$("#tel_notice").html("<em></em>");A.telValidate=true}else{$("#tel").parent().removeClass("params_success");$("#tel").parent().addClass("params_error");$("#tel_notice").html(tel_registered);A.telValidate=false}}})});$("#tel").keyup(function(){$("#tel").parent().removeClass("params_success");$("#tel").parent().addClass("params_error");$("#tel_notice").html("完成验证后，你可以找回登录密码")}).focus(function(){$(this).triggerHandler("keyup")});$("#password1").blur(function(){var B=$(this).val();if(B.length<6){$(this).parent().removeClass("params_success");$(this).parent().addClass("params_error");$("#password_notice").html(password_shorter);A.passwordValidate=false;return false}else{$(this).parent().removeClass("params_error");$(this).parent().addClass("params_success");$("#password_notice").html("<em></em>");A.passwordValidate=true;return true}}).keyup(function(){$(this).triggerHandler("blur")}).focus(function(){$(this).triggerHandler("blur")});$("#conform_password").blur(function(){var B=$("#password1").val();var C=$(this).val();if(C.length<6){$(this).parent().removeClass("params_success");$(this).parent().addClass("params_error");$("#conform_password_notice").html(password_shorter);A.confirmPasswordValidate=false;return false}if(C!=B){$(this).parent().removeClass("params_success");$(this).parent().addClass("params_error");$("#conform_password_notice").html(confirm_password_invalid);A.confirmPasswordValidate=false;return false}else{$(this).parent().removeClass("params_error");$(this).parent().addClass("params_success");$("#conform_password_notice").html("<em></em>");A.confirmPasswordValidate=true;return true}}).keyup(function(){$(this).triggerHandler("blur")}).focus(function(){$(this).triggerHandler("blur")});$("#code").blur(function(){var C=$(this).val();var B=$(this);if(C==""){$("#code_notice").html(msg_code_blank);A.codeValidate=false;return false}$.ajax({type:"GET",url:codeCheck,async:false,data:{code:C},dataType:"json",success:function(D){if(D["code"]==1){$("#code").parent().removeClass("params_error");$("#code").parent().addClass("params_success");$("#code_notice").html("<em></em>");A.codeValidate=true}else{$("#code").parent().removeClass("params_success");$("#code").parent().addClass("params_error");$("#code_notice").html(msg_code);$("#codeImg").triggerHandler("click");A.codeValidate=false}}})});$("#code").focus(function(){$("#code").parent().removeClass("params_success");$("#code").parent().addClass("params_error");$("#code_notice").html("看不清点击图片即可更换验证码")});$(".getCode").mousedown(function(){var B=120;var C=$(this);$("#tel").trigger("blur");$("#code").trigger("blur");if(A.telValidate&&A.codeValidate){C.attr("disabled","true");C.html(B+"秒后重新获取");var D=setInterval(function(){if(B==0){clearInterval(D);C.removeAttr("disabled");C.html("重新发送验证码")}else{B--;C.html(B+"秒后重新获取")}},1000);$.ajax({type:"GET",url:sendUrl,async:false,data:{"tel":$("#tel").val()},dataType:"json",success:function(E){if(E["code"]==1){$("#mobilecode_notice").html(E["msg"]);A.codeValidate=true}else{if(E["code"]==2){$("#mobilecode_notice").html(E["msg"]);A.codeValidate=true}else{$("#mobilecode_notice").html("短信发送失败");A.codeValidate=false}}}})}});$("form[name='formUser']").submit(function(){var B=$(this);var E=$("#mobileCode").val();if($("input[name='agreement']").prop("checked")==false){alert("请选择用户协议");return false}if(E==""){$("#mobileCode").parent().removeClass("params_success");$("#mobileCode").parent().addClass("params_error");$("#mobilecode_notice").html("手机验证码非空");return false}$("#username").trigger("blur");$("#tel").trigger("blur");$("#password1").trigger("blur");$("#conform_password").trigger("blur");$("#code").trigger("blur");if(A.usernameValidate&&A.telValidate&&A.passwordValidate&&A.confirmPasswordValidate&&A.codeValidate){var C=$("#tel").val();var D=false;$.ajax({type:"GET",url:mobileCheck,async:false,data:{tel:C,mobileCode:E},dataType:"json",success:function(F){if(F["code"]==1){return D=true}else{$("#mobileCode").parent().removeClass("params_success");$("#mobileCode").parent().addClass("params_error");$("#mobilecode_notice").html(msg_code);$("#codeImg").triggerHandler("click")}}});return D}else{return false}})});function userEdit(){var E=document.forms["formEdit"];var A=E.elements["email"].value;var F="";var D=null;var B=E.elements["passwd_answer"]?Utils.trim(E.elements["passwd_answer"].value):"";var C=E.elements["sel_question"]?Utils.trim(E.elements["sel_question"].value):"";if(A.length==0){F+=email_empty+"\n"}else{if(!(Utils.isEmail(A))){F+=email_error+"\n"}}if(B.length>0&&C==0||document.getElementById("passwd_quesetion")&&B.length==0){F+=no_select_question+"\n"}for(i=7;i<E.elements.length-2;i++){needinput=document.getElementById(E.elements[i].name+"i")?document.getElementById(E.elements[i].name+"i"):"";if(needinput!=""&&E.elements[i].value.length==0){F+="- "+needinput.innerHTML+msg_blank+"\n"}}if(F.length>0){alert(F);return false}else{return true}}function editPassword(){var C=document.forms["formPassword"];var A=C.elements["old_password"].value;var E=C.elements["new_password"].value;var D=C.elements["comfirm_password"].value;var F="";var B=null;if(A.length==0){F+=old_password_empty+"\n"}if(E.length==0){F+=new_password_empty+"\n"}if(D.length==0){F+=confirm_password_empty+"\n"}if(E.length>0&&D.length>0){if(E!=D){F+=both_password_error+"\n"}}if(F.length>0){alert(F);return false}else{return true}}function submitMsg(){var B=document.forms["formMsg"];var A=B.elements["msg_title"].value;var C=B.elements["msg_content"].value;var D="";if(A.length==0){D+=msg_title_empty+"\n"}if(C.length==0){D+=msg_content_empty+"\n"}if(A.length>200){D+=msg_title_limit+"\n"}if(D.length>0){alert(D);return false}else{return true}}function submitPwdInfo(){var C=document.forms["getPassword"];var D=C.elements["user_name"].value;var A=C.elements["email"].value;var B="";if(D.length==0){B+=user_name_empty+"\n"}if(A.length==0){B+=email_address_empty+"\n"}else{if(!(Utils.isEmail(A))){B+=email_address_error+"\n"}}if(B.length>0){alert(B);return false}$.ajax({type:"post",url:getPassword,headers:{"X-CSRF-TOKEN":$('input[name="_token"]').val()},data:$("#getPassword").serialize(),dataType:"json",async:false,success:function(E){if(E["code"]==1){alert("发送邮件成功请查收重置密码")}else{alert(E["msg"])}}});return false}function submitPwd(){var C=document.forms["resetPassword"];var A=C.elements["new_password"].value;var D=C.elements["confirm_password"].value;var B="";if(A.length==0||A.length<6){B+=new_password_empty+"\n"}if(D.length==0){B+=confirm_password_empty+"\n"}if(D!=A){B+=both_password_error+"\n"}if(B.length>0){alert(B);return false}else{$("#new_password,#confirm_password").val($.md5(A));$.ajax({type:"POST",url:resetPassword,headers:{"X-CSRF-TOKEN":$('input[name="_token"]').val()},data:$("form[name='resetPassword']").serialize(),dataType:"json",async:false,success:function(E){if(E["code"]==1){alert(E["msg"]);window.location.href=loginUrl}else{alert(E["msg"])}}});return false}}function addBooking(){var G=document.forms["formBooking"];var C=G.elements["id"].value;var H=G.elements["rec_id"].value;var A=G.elements["number"].value;var E=G.elements["desc"].value;var B=G.elements["linkman"].value;var D=G.elements["email"].value;var F=G.elements["tel"].value;var J="";if(A.length==0){J+=booking_amount_empty+"\n"}else{var I=/^[0-9]+/;if(!I.test(A)){J+=booking_amount_error+"\n"}}if(E.length==0){J+=describe_empty+"\n"}if(B.length==0){J+=contact_username_empty+"\n"}if(D.length==0){J+=email_empty+"\n"}else{if(!(Utils.isEmail(D))){J+=email_error+"\n"}}if(F.length==0){J+=contact_phone_empty+"\n"}if(J.length>0){alert(J);return false}return true}function userLogin(){var B=$("#formLogin input[name='username']");var A=$("#formLogin input[name='password']");var C=document.forms["formLogin"];var D="";if(B.val().length==0){D+=username_empty+"\n";B.focus()}if(A.val().length==0){D+=password_empty+"\n";A.focus()}if(D.length>0){alert(D);return false}else{A.val($.md5(A.val()));$.ajax({type:"post",url:loginCheck,headers:{"X-CSRF-TOKEN":$('input[name="_token"]').val()},data:$("#formLogin").serialize(),dataType:"json",async:false,success:function(E){if(E["code"]==1){alert(E["msg"]);window.location.href=indexUrl}else{alert(E["msg"])}}});return false}}function chkstr(B){for(var A=0;A<B.length;A++){if(B.charCodeAt(A)<127&&!B.substr(A,1).match(/^\w+$/ig)){return false}}return true}function check_password(A){if(A.length<6){$("#password1").parent().removeClass("params_success");$("#password1").parent().addClass("params_error");document.getElementById("password_notice").innerHTML=password_shorter;validate.passwordValidate=false;return false}else{$("#password1").parent().removeClass("params_error");$("#password1").parent().addClass("params_success");document.getElementById("password_notice").innerHTML="<em></em>";validate.passwordValidate=true;return true}}function check_conform_password(A){password=document.getElementById("password1").value;if(A.length<6){$("#conform_password").parent().removeClass("params_success");$("#conform_password").parent().addClass("params_error");document.getElementById("conform_password_notice").innerHTML=password_shorter;validate.confirmPasswordValidate=false;return false}if(A!=password){$("#conform_password").parent().removeClass("params_success");$("#conform_password").parent().addClass("params_error");document.getElementById("conform_password_notice").innerHTML=confirm_password_invalid;validate.confirmPasswordValidate=false;return false}else{$("#conform_password").parent().removeClass("params_error");$("#conform_password").parent().addClass("params_success");document.getElementById("conform_password_notice").innerHTML="<em></em>";validate.confirmPasswordValidate=true;return true}}function is_registered(B){var C=B.replace(/[^\x00-\xff]/g,"**").length;if(B==""){document.getElementById("username_notice").innerHTML=msg_un_blank;validate.usernameValidate=false;return false}if(!chkstr(B)){document.getElementById("username_notice").innerHTML=msg_un_format;validate.usernameValidate=false;return false}if(C<3){document.getElementById("username_notice").innerHTML=username_shorter;validate.usernameValidate=false;return false}if(C>14){document.getElementById("username_notice").innerHTML=msg_un_length;validate.usernameValidate=false;return false}var A="username";$.ajax({type:"GET",url:uniqueCheck,async:false,data:{type:A,value:B},dataType:"json",error:function(){alert("连接失败");return false},success:function(D){if(D["code"]==1){$("#username").parent().removeClass("params_error");$("#username").parent().addClass("params_success");document.getElementById("username_notice").innerHTML="<em></em>";validate.usernameValidate=true}else{$("#username").parent().removeClass("params_success");$("#username").parent().addClass("params_error");document.getElementById("username_notice").innerHTML=msg_un_registered;validate.usernameValidate=false}}});return validate.usernameValidate}function checkEmail(B){if(B==""){document.getElementById("email_notice").innerHTML=msg_email_blank;validate.emailValidate=false;return false}else{if(!Utils.isEmail(B)){document.getElementById("email_notice").innerHTML=msg_email_format;validate.emailValidate=false;return false}}var A="email";$.ajax({type:"GET",url:uniqueCheck,async:false,data:{type:A,value:B},dataType:"json",error:function(){alert("连接失败");return false},success:function(C){if(C["code"]==1){$("#email").parent().removeClass("params_error");$("#email").parent().addClass("params_success");document.getElementById("email_notice").innerHTML="<em></em>";validate.emailValidate=true}else{$("#email").parent().removeClass("params_success");$("#email").parent().addClass("params_error");document.getElementById("email_notice").innerHTML=msg_email_registered;validate.emailValidate=false}}});return validate.emailValidate}function check_code(A){if(A==""){document.getElementById("code_notice").innerHTML=msg_code_blank;validate.codeValidate=false;return false}$.ajax({type:"GET",url:codeCheck,async:false,data:{code:A},dataType:"json",error:function(){alert("连接失败");return false},success:function(B){if(B["code"]==1){$("#code").parent().removeClass("params_error");$("#code").parent().addClass("params_success");document.getElementById("code_notice").innerHTML="<em></em>";validate.codeValidate=true}else{$("#code").parent().removeClass("params_success");$("#code").parent().addClass("params_error");document.getElementById("code_notice").innerHTML=msg_code;validate.codeValidate=false}}});return validate.codeValidate}function checkTel(B){if(B==""){document.getElementById("tel_notice").innerHTML=tel_empty;validate.telValidate=false;return false}else{if(!Utils.isTel(B)){document.getElementById("tel_notice").innerHTML=tel_msg;validate.telValidate=false;return false}}var A="tel";$.ajax({type:"GET",url:uniqueCheck,async:false,data:{type:A,value:B},dataType:"json",error:function(){alert("连接失败");return false},success:function(C){if(C["code"]==1){$("#tel").parent().removeClass("params_error");$("#tel").parent().addClass("params_success");document.getElementById("tel_notice").innerHTML="<em></em>";validate.telValidate=true}else{$("#tel").parent().removeClass("params_success");$("#tel").parent().addClass("params_error");document.getElementById("tel_notice").innerHTML=tel_registered;validate.telValidate=false}}});return validate.telValidate}function saveOrderAddress(I){var C=document.forms["formAddress"];var H=C.elements["consignee"].value;var F=C.elements["email"].value;var B=C.elements["address"].value;var A=C.elements["zipcode"].value;var G=C.elements["tel"].value;var E=C.elements["mobile"].value;var J=C.elements["sign_building"].value;var K=C.elements["best_time"].value;if(I==0){alert(current_ss_not_unshipped);return false}var D="";if(B.length==0){D+=address_name_not_null+"\n"}if(H.length==0){D+=consignee_not_null+"\n"}if(D.length>0){alert(D);return false}else{return true}}function submitSurplus(){var D=document.forms["formSurplus"];var B=D.elements["surplus_type"].value;var G=D.elements["amount"].value;var E=D.elements["user_note"].value;var A=0;var F="";if(G.length==0){F+=surplus_amount_empty+"\n"}else{var C=/^[\.0-9]+/;if(!C.test(G)){F+=surplus_amount_error+"\n"}}if(E.length==0){F+=process_desc+"\n"}if(F.length>0){alert(F);return false}if(B==0){for(i=0;i<D.elements.length;i++){if(D.elements[i].name=="payment_id"&&D.elements[i].checked){A=D.elements[i].value;break}}if(A==0){alert(payment_empty);return false}}return true}function addBonus(){var B=document.forms["addBouns"];var C=B.elements["bonus_sn"].value;if(C.length==0){alert(bonus_sn_empty);return false}else{var A=/^[0-9]{10}$/;if(!A.test(C)){alert(bonus_sn_error);return false}}return true}function mergeOrder(){if(!confirm(confirm_merge)){return false}var B=document.forms["formOrder"];var C=B.elements["from_order"].value;var A=B.elements["to_order"].value;var D="";if(C==0){D+=from_order_empty+"\n"}if(A==0){D+=to_order_empty+"\n"}else{if(A==C){D+=order_same+"\n"}}if(D.length>0){alert(D);return false}else{return true}}function returnToCart(A){Ajax.call("user.php?act=return_to_cart","order_id="+A,returnToCartResponse,"POST","JSON")}function returnToCartResponse(A){alert(A.message)}function checkIntensity(E){var F="#FFF",A="#FFF",H="#FFF";var G=0;var D=0;for(i=0;i<E.length;i++){var B=0;var C=E.charCodeAt(i);if(C>=48&&C<=57){B=1}else{if(C>=65&&C<=90){B=2}else{if(C>=97&&C<=122){B=4}else{B=4}}}D|=B}for(i=0;i<4;i++){if(D&1){G++}D>>>=1}if(E.length<=4){G=1}switch(G){case 1:A="2px solid red";F=H="2px solid #DADADA";break;case 2:F="2px solid #f90";A=H="2px solid #DADADA";break;case 3:H="2px solid #3c0";A=F="2px solid #DADADA";break;case 4:H="2px solid #3c0";A=F="2px solid #DADADA";break;default:H=F=A="";break}if(document.getElementById("pwd_lower")){document.getElementById("pwd_lower").style.borderBottom=A;document.getElementById("pwd_middle").style.borderBottom=F;document.getElementById("pwd_high").style.borderBottom=H}}function changeType(A){if(A.getAttribute("min")&&document.getElementById("ECS_AMOUNT")){document.getElementById("ECS_AMOUNT").disabled=false;document.getElementById("ECS_AMOUNT").value=A.getAttribute("min");if(document.getElementById("ECS_NOTICE")&&A.getAttribute("to")&&A.getAttribute("fee")){var C=parseInt(A.getAttribute("fee"));var B=parseInt(A.getAttribute("to"));if(C<0){B=B+C*2}document.getElementById("ECS_NOTICE").innerHTML=notice_result+B}}}function calResult(){var G=document.getElementById("ECS_AMOUNT").value;var B=document.getElementById("ECS_NOTICE");reg=/^\d+$/;if(!reg.test(G)){B.innerHTML=notice_not_int;return}G=parseInt(G);var C=document.forms["transform"];for(i=0;i<C.elements["type"].length;i++){if(C.elements["type"][i].checked){var A=parseInt(C.elements["type"][i].getAttribute("min"));var D=parseInt(C.elements["type"][i].getAttribute("to"));var F=parseInt(C.elements["type"][i].getAttribute("fee"));var E=0;if(G<A){B.innerHTML=notice_overflow+A;return}if(F>0){E=(G-F)*D/(A-F)}else{E=G*(D+F)/A+F}B.innerHTML=notice_result+parseInt(E+0.5)}}};